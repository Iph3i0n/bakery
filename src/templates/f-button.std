<script>
  import { FindForm } from "../form-element.ts";
  import * as theme from "../theme.ts";

  export const name = "f-button";
  export const props = {
    colour: "primary",
    type: undefined,
    href: undefined,
    target: undefined,
    private: false,
  };
  export const aria = { Role: "button" };

  self.tabIndex = 0;

  let initialised = false;

  self.addEventListener("loaded", () => {
    if (initialised) return;
    initialised = true;

    self.addEventListener("click", () => {
      if (self.props.type === "button") return;
      else if (self.props.type === "submit") {
        const form = FindForm(self);
        if (!form) throw new Error("Cannot use a submit outside of a form");
        form.requestSubmit();
      } else if (self.props.href)
        if (self.props.target)
          window.open(
            self.props.href,
            self.props.target,
            self.props.private ? "noreferrer" : undefined
          );
        else window.location.href = self.props.href;
    });
  });
</script>

<style>
  @js const c = self.props.colour ?? 'primary';
  :host {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.5em;
    theme.colour(c);
    theme.padding("small_block");
    theme.border("body");
    theme.text("body", "no-margin");
    -webkit-user-select: none;
    user-select: none;
    cursor: pointer;
    text-align: center;
    box-shadow: none;
    theme.transition("fast", "background-color", "border-color", "box-shadow");
  }

  :host(:hover),
  :host(:focus) {
    outline: none;
    theme.colour(c, 1.1);
    theme.border("body", "contrast");
    theme.shadow("small");
  }
</style>

<slot></slot>
